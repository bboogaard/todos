{% extends 'base.html' %}

{% load static %}


{% block nav %}
<!-- Top Navigation -->
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="{% url 'todos:index' %}">Home</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Wallpapers</a>
        <div class="dropdown-menu" aria-labelledby="dropdown01">
            <a class="dropdown-item" href="#" data-action="next-wallpaper">
                Next wallpaper
            </a>
            <a class="dropdown-item" href="#" data-action="manage-wallpapers">
                Manage wallpapers
            </a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown02" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Galleries</a>
        <div class="dropdown-menu" aria-labelledby="dropdown02">
            {% for id, gallery in galleries %}
            <a class="dropdown-item" href="#" data-setting-name="gallery" data-setting-value="{{ id }}">
              {% if settings.gallery == id %}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16">
<path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
              </svg>
              {% endif %}{{ gallery }}</a>
             {% endfor %}
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown03" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Import/export</a>
        <div class="dropdown-menu" aria-labelledby="dropdown03">
            <a class="dropdown-item" href="#" data-action="import-todos">
                Import todo's
            </a>
            <a class="dropdown-item" href="{% url 'todos:todos_export' %}">
                Export todo's
            </a>
            <a class="dropdown-item" href="#" data-action="import-notes">
                Import notes
            </a>
            <a class="dropdown-item" href="{% url 'todos:notes_export' %}">
                Export notes
            </a>
            <a class="dropdown-item" href="#" data-action="import-files">
                Import files
            </a>
            <a class="dropdown-item" href="{% url 'todos:file_export' 'file' %}">
                Export files
            </a>
            <a class="dropdown-item" href="#" data-action="import-images">
                Import images
            </a>
            <a class="dropdown-item" href="{% url 'todos:file_export' 'image' %}">
                Export images
            </a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Settings</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="#" data-action="manage-widgets">
              Manage widgets
          </a>
          <a class="dropdown-item" href="#" data-setting-name="todos_provider" data-setting-value="{% if settings.todos_provider == 'local' %}remote{% else %}local{% endif %}">
              {% if settings.todos_provider == 'remote' %}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16">
<path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
</svg>{% endif %}
          Save todo's in database</a>
          <a class="dropdown-item" href="#" data-action="manage-files">
              Manage files
          </a>
          <a class="dropdown-item" href="#" data-action="manage-images">
              Manage images
          </a>
          <a class="dropdown-item" href="#" data-setting-name="notes_provider" data-setting-value="{% if settings.notes_provider == 'local' %}remote{% else %}local{% endif %}">
              {% if settings.notes_provider == 'remote' %}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16">
<path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
</svg>{% endif %}
          Save notes in database</a>
          <a class="dropdown-item" id="about-link" href="#">About</a>
        </div>
      </li>
    </ul>
    <form method="get" action="{% url 'todos:search' %}" class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="text" name="q" placeholder="Search" aria-label="Search" value="{{ search_form.q.value|default_if_none:'' }}">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
  </div>
</nav>
{% endblock %}

{% block main %}
    {% block content %}
    {% endblock %}

<form method="post" id="settings-form" action="{% url 'todos:settings_save' %}">
  {%  csrf_token %}
  <input type="hidden" name="todos_provider" id="todos_provider" value="{{ settings.todos_provider }}">
  <input type="hidden" name="gallery" id="gallery" value="{{ settings.gallery|default_if_none:'' }}">
  <input type="hidden" name="notes_provider" id="notes_provider" value="{{ settings.notes_provider }}">
</form>
{% endblock %}

{% block javascript %}
<script type="text/javascript">
  $(function () {
      $('[data-setting-name]').click(function (event) {
          event.preventDefault();
          $('#settings-form').find('#' + $(this).data('setting-name')).val($(this).data('setting-value'));
          $('#settings-form').submit();
      });
  });
</script>
  {{ wallpapers|json_script:"wallpapers" }}
<script type="text/javascript" src="{% static 'wallpaper.jquery.js' %}"></script>
<script type="text/javascript">
  $(function () {
      $('body').wallPaper({
          items: JSON.parse(document.getElementById('wallpapers').textContent)
      });
      const MANAGE_WIDGETS = 'Manage widgets';
      const MANAGE_WALLPAPERS = 'Manage wallpapers';
      const MANAGE_FILES = 'Manage files';
      const MANAGE_IMAGES = 'Manage images';
      const IMPORT_TODOS = "Import todo's";
      const IMPORT_NOTES = "Import notes";
      const IMPORT_FILES = "Import files";
      const IMPORT_IMAGES = "Import images";

      $('[data-action="next-wallpaper"]').click(function() {
          $('body').trigger('next-wallpaper');
      });
      $('#about-link').click(function(event) {
          event.preventDefault();
          eModal.alert("Todo's - Version 1.0");
      });
      $('[data-action="manage-widgets"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:widget_list" %}', MANAGE_WIDGETS);
      });
      $('[data-action="manage-wallpapers"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:wallpaper_list" %}', MANAGE_WALLPAPERS);
      });
      $('[data-action="manage-files"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:file_list" "file" %}', MANAGE_FILES);
      });
      $('[data-action="manage-images"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:file_list" "image" %}', MANAGE_IMAGES);
      });
      $('[data-action="import-todos"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:todos_import" %}', IMPORT_TODOS);
      });
      $('[data-action="import-notes"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:notes_import" %}', IMPORT_NOTES);
      });
      $('[data-action="import-files"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:file_import" 'file' %}', IMPORT_FILES);
      });
      $('[data-action="import-images"]').click(function (event) {
         event.preventDefault();
         eModal.iframe('{% url "todos:file_import" 'image' %}', IMPORT_IMAGES);
      });
      $(document).on('hide.bs.modal', function(event) {
          let modal = $.trim($(event.target).find('.modal-title').text());
          let refreshModals = [
              MANAGE_WIDGETS, MANAGE_WALLPAPERS, MANAGE_FILES, MANAGE_IMAGES, IMPORT_TODOS, IMPORT_NOTES,
              IMPORT_FILES, IMPORT_IMAGES
          ];
          if (refreshModals.indexOf(modal) !== -1) {
              location.href = '{{ request.path }}';
          }
      });
  });
</script>
{% endblock %}